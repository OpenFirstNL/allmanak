{#if showModal}
<Modal on:close="set({showModal: false})" showBackdropClose>
  <ReportForm on:close="set({showModal: false})" />
</Modal>
{/if}
<Nav segment={child.segment} {categories} on:report='set({showModal: true})'/>

<main>
	<svelte:component this={child.component} {...child.props} on:report='set({showModal: true})'/>
</main>

<style>
	main {
		position: relative;
		background-color: white;
		box-sizing: border-box;
		/*max-width: 56em;
		padding: 2em;
		margin: 0 auto;*/
	}
</style>

<Footer {categories} on:report='set({showModal: true})'/>

<script>
	import FontFaceObserver from 'fontfaceobserver';
	//import {categoriesApi} from './_categories.json.js';
	import categories from './_categories.json';
	import {apiBaseUri} from '../apibase.js';

	export default {
		oncreate() {
			['montserratsemibold', 'montserratregular', 'open_sansbold', 'open_sansregular'].forEach(
				fontName => {
					const font = new FontFaceObserver(fontName);
					font.load().then(_ => {
						document.body.classList.add('fontloaded-' + fontName);
					}).catch(e => {
						console.log('Error lazy loading font', fontName, e);
					});
				}
			);
		},
	    data() {
	      return {
	        categories,
	        showModal: false,
	      };
	    },

		// async preload({ params, query }) {
		// 	const res = await this.fetch('categories.json');
		// 	if (res.status === 200) {
  // 	 			const categories = await res.json();
  // 	 			return {categories};
		// 	} else {
		// 	 	this.error(res.status, data.message);
		// 	}
		// },
		components: {
			Nav: '../components/Nav.html',
			Footer: '../components/Footer.html',
			Modal: '../components/Modal.html',
			ReportForm: '../components/ReportForm.html',
		}
	};
</script>